import{_ as A,M as w,o as C,c as x,a as e,r as m,b as o,h as c,k as r,g as b,F as V,i as L,f as S,t as f,v as D,w as E,n as h}from"./index-1gFIueeT.js";const U={data(){return{myModal:""}},methods:{openModal(){this.myModal.show()},closeModal(){this.myModal.hide()}},mounted(){this.myModal=new w(this.$refs.modal)}},q={class:"modal fade",id:"delAllModal","aria-hidden":"true",tabindex:"-1",ref:"modal"},N={class:"modal-dialog"},B={class:"modal-content"},F=e("div",{class:"modal-header bg-danger"},[e("h5",{class:"modal-title text-light"},"清空購物車"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),I=e("div",{class:"modal-body"},[e("p",null,"確定清空購物車內的所有品項嗎？")],-1),P={class:"modal-footer"},T=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function j(l,s,i,u,t,d){return C(),x("div",q,[e("div",N,[e("div",B,[F,I,e("div",P,[T,e("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=M=>this.$emit("clear-all"))},"確定刪除")])])])],512)}const z=A(U,[["render",j]]),_="https://vue3-course-api.hexschool.io/v2",p="rock",R={components:{DeleteAllModal:z},data(){return{user:{email:"",name:"",address:"",tel:""},couponCode:"",message:"",cart:[],products:[],tempProduct:{},isDiscount:!1,isLoading:!1,isEntering:!1,isDeleteAll:!1,isSending:!1}},methods:{isPhone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"需要正確的電話號碼"},onSubmit(){if(this.cart.carts.length===0)alert("購物車不得為空");else{this.isSending=!0;const l={data:{user:this.user,message:this.message}};this.$http.post(`${_}/api/${p}/order`,l).then(s=>{this.isSending=!1,alert(s.data.message),location.reload()}).catch(s=>{this.isSending=!1;let i="";s.data.message.forEach(u=>{i+=u+`
\r`}),alert(i)})}},getCart(){this.isLoading=!0,this.$http.get(`${_}/api/${p}/cart`).then(l=>{this.cart={...l.data.data};for(let s=0;s<this.cart.carts.length;s++)this.cart.carts[s].cancelLoading=!1;this.isLoading=!1}).catch(l=>{console.dir(l),this.isLoading=!1})},renewCart(l,s){this.isEntering=!0,this.$http.put(`${_}/api/${p}/cart/${l.id}`,{data:{product_id:l.product.id,qty:s}}).then(i=>{alert(i.data.message),this.isEntering=!1,this.getCart()}).catch(i=>{alert(i.message),this.isEntering=!1})},clearCart(){if(this.$refs.deleteAllModal.closeModal(),this.cart.carts.length===0){alert("購物車已經是空的");return}this.isDeleteAll=!0,this.$http.delete(`${_}/api/${p}/carts`).then(l=>{this.isDeleteAll=!1,alert("全部商品"+l.data.message),this.cart={carts:[]}}).catch(l=>{this.isDeleteAll=!1,alert(l.message)})},deleteItem(l){l.cancelLoading=!0,this.$http.delete(`${_}/api/${p}/cart/${l.id}`).then(s=>{alert(`${l.product.title}${s.data.message}`),l.cancelLoading=!1,this.getCart()}).catch(s=>{alert(s.message),l.cancelLoading=!1})},sendCouponCode(){this.isDiscount=!0;const l={code:this.couponCode};this.$http.post(`${_}/api/${p}/coupon`,{data:l}).then(s=>{alert(s.data.message),this.getCart(),this.isDiscount=!1}).catch(s=>{alert(s.response.data.message),this.isDiscount=!1})},currency(l){return`${parseInt(l,10).toFixed(0).replace(/./g,(i,u,t)=>u&&i!=="."&&(t.length-u)%3===0?`, ${i}`.replace(/\s/g,""):i)}`},openDeleteAllModal(){this.$refs.deleteAllModal.openModal()}},mounted(){this.getCart()}},G={class:"container"},H=e("div",{class:"text-center h3 my-4"},"購物車頁面",-1),J={class:"text-end"},K=["disabled"],O={class:"table align-middle"},Q=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),W=["onClick"],X={class:"text-success"},Y={class:"input-group input-group-sm"},Z={class:"input-group mb-3"},ee=["disabled","onUpdate:modelValue","onChange"],se={class:"input-group-text",id:"basic-addon2"},te={class:"text-end"},le={class:"text-success"},ae=e("td",{colspan:"3",class:"text-end"},"總計",-1),oe={class:"text-end"},ne=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ie={class:"text-end text-success"},de={class:"row"},ce={class:"col-4 ms-auto"},re={class:"input-group mb-3"},ue=["disabled"],me={class:"my-5 row justify-content-center"},he={class:"mb-3"},_e=e("label",{for:"email",class:"form-label"},"Email",-1),pe={class:"mb-3"},be=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),fe={class:"mb-3"},ge=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),ve={class:"mb-3"},ye=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Ce={class:"mb-3"},xe=e("label",{for:"message",class:"form-label"},"留言",-1),De={class:"text-end"},Me=["disabled"];function Ve(l,s,i,u,t,d){const M=m("myLoading"),g=m("font-awesome-icon"),v=m("v-field"),y=m("error-message"),$=m("v-form"),k=m("DeleteAllModal");return C(),x(V,null,[o(M,{active:t.isLoading},null,8,["active"]),e("div",G,[H,e("div",J,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=a=>d.openDeleteAllModal()),disabled:t.isDeleteAll},[c(o(g,{icon:"spinner",class:"fa-spin"},null,512),[[r,t.isDeleteAll]]),b(" 清空購物車 ")],8,K)]),e("table",O,[Q,e("tbody",null,[t.cart?(C(!0),x(V,{key:0},L(t.cart.carts,a=>(C(),x("tr",{key:a.id},[e("td",null,[e("button",{type:"button",class:h(["btn btn-outline-danger btn-sm",{disabled:a.cancelLoading}]),onClick:n=>d.deleteItem(a)},[c(o(g,{icon:"spinner",class:"fa-spin"},null,512),[[r,a.cancelLoading]]),b(" x ")],10,W)]),e("td",null,[b(f(a.product.title)+" ",1),c(e("div",X,"已套用優惠券",512),[[r,a.final_total!==a.total]])]),e("td",null,[e("div",Y,[e("div",Z,[c(e("input",{min:"1",type:"number",class:"form-control",disabled:t.isEntering,"onUpdate:modelValue":n=>a.qty=n,onChange:n=>d.renewCart(a,a.qty)},null,40,ee),[[D,a.qty]]),e("span",se,f(a.product.unit),1)])])]),e("td",te,[c(e("small",le,"折扣價：",512),[[r,a.final_total!==a.total]]),e("span",{class:h({"text-success":a.final_total!==a.total})},f(d.currency(a.final_total)),3)])]))),128)):S("",!0)]),e("tfoot",null,[e("tr",null,[ae,e("td",oe,f(t.cart.total),1)]),c(e("tr",null,[ne,e("td",ie,f(d.currency(t.cart.final_total)),1)],512),[[r,t.cart.total!==t.cart.final_total]])])]),e("div",de,[e("div",ce,[e("div",re,[c(e("input",{type:"text",class:"form-control",placeholder:"請輸入折扣碼","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":s[1]||(s[1]=a=>t.couponCode=a)},null,512),[[D,t.couponCode]]),e("button",{class:"btn btn-outline-primary",type:"button",disabled:t.isDiscount,id:"button-addon2",onClick:s[2]||(s[2]=a=>d.sendCouponCode())},[c(o(g,{icon:"spinner",class:"fa-spin"},null,512),[[r,t.isDiscount]]),b(" 送出折扣碼")],8,ue)])])]),e("div",me,[o($,{onSubmit:d.onSubmit,ref:"form",class:"col-md-6"},{default:E(({errors:a})=>[e("div",he,[_e,o(v,{id:"email",name:"email",type:"email",class:h(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:t.user.email,"onUpdate:modelValue":s[3]||(s[3]=n=>t.user.email=n)},null,8,["class","modelValue"]),o(y,{name:"email",class:"invalid-feedback"})]),e("div",pe,[be,o(v,{id:"name",name:"姓名",type:"text",class:h(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.user.name,"onUpdate:modelValue":s[4]||(s[4]=n=>t.user.name=n)},null,8,["class","modelValue"]),o(y,{name:"姓名",class:"invalid-feedback"})]),e("div",fe,[ge,o(v,{id:"tel",name:"電話",type:"text",class:h(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:d.isPhone,modelValue:t.user.tel,"onUpdate:modelValue":s[5]||(s[5]=n=>t.user.tel=n)},null,8,["class","rules","modelValue"]),o(y,{name:"電話",class:"invalid-feedback"})]),e("div",ve,[ye,o(v,{id:"address",name:"地址",type:"text",class:h(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:t.user.address,"onUpdate:modelValue":s[6]||(s[6]=n=>t.user.address=n)},null,8,["class","modelValue"]),o(y,{name:"地址",class:"invalid-feedback"})]),e("div",Ce,[xe,c(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[7]||(s[7]=n=>t.message=n)},null,512),[[D,t.message]])]),e("div",De,[e("button",{type:"submit",class:"btn btn-danger",disabled:t.isSending},[c(o(g,{icon:"spinner",class:"fa-spin"},null,512),[[r,t.isSending]]),b(" 送出訂單 ")],8,Me)])]),_:1},8,["onSubmit"])])]),o(k,{onClearAll:d.clearCart,ref:"deleteAllModal"},null,8,["onClearAll"])],64)}const $e=A(R,[["render",Ve]]);export{$e as default};
