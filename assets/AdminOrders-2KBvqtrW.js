import{_ as k,M as D,o as d,c as n,a as e,t as o,f as y,F as _,i as O,h as p,j as v,r as m,b,k as g}from"./index-UMp20Tq9.js";import{D as C}from"./DeleteModal-NM61Nhdk.js";const w={data(){return{tempOrder:{user:{}},orderModal:""}},props:["selectedOrder"],methods:{date(s){return new Date(s*1e3).toLocaleDateString()},currency(s){return`${parseInt(s,10).toFixed(0).replace(/./g,(i,u,t)=>u&&i!=="."&&(t.length-u)%3===0?`, ${i}`.replace(/\s/g,""):i)}`},openModal(){this.tempOrder={...this.selectedOrder},this.orderModal.show()},closeModal(){this.orderModal.hide()}},watch:{selectedOrder(){this.tempOrder={...this.selectedOrder}}},mounted(){this.orderModal=new D(this.$refs.modal)}},L={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog modal-xl",role:"document"},V={class:"modal-content border-0"},P=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),U={class:"modal-body"},F={class:"row"},I={class:"col-md-4"},B=e("h3",null,"用戶資料",-1),E={class:"table"},N={key:0},j=e("th",{style:{width:"100px"}},"姓名",-1),q=e("th",null,"Email",-1),A=e("th",null,"電話",-1),z=e("th",null,"地址",-1),G={class:"col-md-8"},H=e("h3",null,"訂單細節",-1),J={class:"table"},K=e("th",{style:{width:"100px"}},"訂單編號",-1),Q=e("th",null,"下單時間",-1),R=e("th",null,"付款時間",-1),T={key:0},W={key:1},X=e("th",null,"付款狀態",-1),Y={key:0,class:"text-success"},Z={key:1,class:"text-muted"},ee=e("th",null,"總金額",-1),te=e("h3",null,"選購商品",-1),se={class:"table"},le=e("thead",null,[e("tr")],-1),oe={class:"text-end"},de={class:"d-flex justify-content-end"},ne={class:"form-check"},re={class:"form-check-label",for:"flexCheckDefault"},ae={key:0},ce={key:1},ie={class:"modal-footer"},he=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ue(s,l,i,u,t,a){return d(),n("div",L,[e("div",S,[e("div",V,[P,e("div",U,[e("div",F,[e("div",I,[B,e("table",E,[t.tempOrder.user?(d(),n("tbody",N,[e("tr",null,[j,e("td",null,o(t.tempOrder.user.name),1)]),e("tr",null,[q,e("td",null,o(t.tempOrder.user.email),1)]),e("tr",null,[A,e("td",null,o(t.tempOrder.user.tel),1)]),e("tr",null,[z,e("td",null,o(t.tempOrder.user.address),1)])])):y("",!0)])]),e("div",G,[H,e("table",J,[e("tbody",null,[e("tr",null,[K,e("td",null,o(t.tempOrder.id),1)]),e("tr",null,[Q,e("td",null,o(a.date(t.tempOrder.create_at)),1)]),e("tr",null,[R,e("td",null,[t.tempOrder.paid_date?(d(),n("span",T,o(a.date(t.tempOrder.paid_date)),1)):(d(),n("span",W,"時間不正確"))])]),e("tr",null,[X,e("td",null,[t.tempOrder.is_paid?(d(),n("strong",Y,"已付款")):(d(),n("span",Z,"尚未付款"))])]),e("tr",null,[ee,e("td",null,o(a.currency(t.tempOrder.total)),1)])])]),te,e("table",se,[le,e("tbody",null,[(d(!0),n(_,null,O(t.tempOrder.products,c=>(d(),n("tr",{key:c.id},[e("th",null,o(c.product.title),1),e("td",null,o(c.qty)+" / "+o(c.product.unit),1),e("td",oe,o(a.currency(c.final_total)),1)]))),128))])]),e("div",de,[e("div",ne,[p(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":l[0]||(l[0]=c=>t.tempOrder.is_paid=c)},null,512),[[v,t.tempOrder.is_paid]]),e("label",re,[t.tempOrder.is_paid?(d(),n("span",ae,"已付款")):(d(),n("span",ce,"未付款"))])])])])])]),e("div",ie,[he,e("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=c=>s.$emit("update-paid",t.tempOrder))}," 修改付款狀態 ")])])])],512)}const _e=k(w,[["render",ue]]),f="https://vue3-course-api.hexschool.io/v2",M="rock",pe={data(){return{orders:[],isLoading:!1,tempOrder:{}}},methods:{getOrders(){this.isLoading=!0,this.$http.get(`${f}/api/${M}/admin/orders`).then(s=>{this.orders=[...s.data.orders],this.isLoading=!1}).catch(s=>{console.log(s.response.data.message),this.isLoading=!1})},date(s){return new Date(s*1e3).toLocaleDateString()},currency(s){return`${parseInt(s,10).toFixed(0).replace(/./g,(i,u,t)=>u&&i!=="."&&(t.length-u)%3===0?`, ${i}`.replace(/\s/g,""):i)}`},openDelOrderModal(s){this.tempOrder=s,this.$refs.deleteModal.openModal()},updatePaid(s){this.$http.put(`${f}/api/${M}/admin/order/${s.id}`,{data:s}).then(l=>{alert(l.data.message),this.$refs.orderModal.closeModal(),this.getOrders()}).catch(l=>{console.log(l),alert(l.response.data.message),this.$refs.orderModal.closeModal()})},deleteOrder(s){this.$http(`${f}/api/path/admin/order/${s}`).then(l=>{console.log(l),this.$refs.deleteModal.hideModal()}).catch(l=>{console.log(l),this.$refs.deleteModal.hideModal()})},openModal(s){this.tempOrder=s,this.$refs.orderModal.openModal()}},mounted(){this.getOrders()},components:{DeleteModal:C,OrderModal:_e}},me=e("div",{class:"h3 text-center mt-4"},"訂單列表",-1),be={class:"container"},fe={class:"table mt-4"},ye=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Oe={key:0},ge=["textContent"],Me={class:"list-unstyled"},ke={class:"text-right"},ve={class:"form-check form-switch"},xe=["id","onUpdate:modelValue","onChange"],$e=["for"],De={class:"btn-group"},Ce=["onClick"],we=["onClick"];function Le(s,l,i,u,t,a){const c=m("myLoading"),x=m("DeleteModal"),$=m("OrderModal");return d(),n(_,null,[b(c,{active:t.isLoading},null,8,["active"]),me,e("div",be,[e("table",fe,[ye,e("tbody",null,[(d(!0),n(_,null,O(t.orders,r=>(d(),n(_,{key:r.id},[t.orders.length?(d(),n("tr",Oe,[e("td",null,o(a.date(r.create_at)),1),e("td",null,[r.user?(d(),n("span",{key:0,textContent:o(r.user.email)},null,8,ge)):y("",!0)]),e("td",null,[e("ul",Me,[(d(!0),n(_,null,O(r.products,h=>(d(),n("li",{key:h.id},o(h.product.title)+" 數量："+o(h.qty)+" "+o(h.product.unit),1))),128))])]),e("td",ke,o(r.total),1),e("td",null,[e("div",ve,[p(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${r.id}`,"onUpdate:modelValue":h=>r.is_paid=h,onChange:h=>a.updatePaid(r)},null,40,xe),[[v,r.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${r.id}`},[p(e("span",null,"已付款",512),[[g,r.is_paid]]),p(e("span",null,"未付款",512),[[g,!r.is_paid]])],8,$e)])]),e("td",null,[e("div",De,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:h=>a.openModal(r)}," 檢視 ",8,Ce),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:h=>a.openDelOrderModal(r)}," 刪除 ",8,we)])])])):y("",!0)],64))),128))])])]),b(x,{product:t.tempOrder,onDeleteItem:a.deleteOrder,ref:"deleteModal"},null,8,["product","onDeleteItem"]),b($,{selectedOrder:t.tempOrder,onUpdatePaid:a.updatePaid,ref:"orderModal"},null,8,["selectedOrder","onUpdatePaid"])],64)}const Pe=k(pe,[["render",Le]]);export{Pe as default};
