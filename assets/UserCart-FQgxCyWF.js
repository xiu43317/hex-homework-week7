import{_ as $,M as w,o as y,c as C,a as e,r as u,b as o,h as c,k as m,g as v,F as V,i as L,f as E,t as b,v as D,w as U,n as h}from"./index-UMp20Tq9.js";const q={data(){return{myModal:""}},methods:{openModal(){this.myModal.show()},closeModal(){this.myModal.hide()}},mounted(){this.myModal=new w(this.$refs.modal)}},N={class:"modal fade",id:"delAllModal","aria-hidden":"true",tabindex:"-1",ref:"modal"},S={class:"modal-dialog"},B={class:"modal-content"},F=e("div",{class:"modal-header bg-danger"},[e("h5",{class:"modal-title text-light"},"清空購物車"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),I=e("div",{class:"modal-body"},[e("p",null,"確定清空購物車內的所有品項嗎？")],-1),P={class:"modal-footer"},T=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function j(l,t,i,r,s,d){return y(),C("div",N,[e("div",S,[e("div",B,[F,I,e("div",P,[T,e("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=M=>this.$emit("clear-all"))},"確定刪除")])])])],512)}const z=$(q,[["render",j]]),_="https://vue3-course-api.hexschool.io/v2",p="rock",R={components:{DeleteAllModal:z},data(){return{user:{email:"",name:"",address:"",tel:""},couponCode:"",message:"",cart:[],products:[],tempProduct:{},isDiscount:!1,isLoading:!1,isEntering:!1,isDeleteAll:!1}},methods:{isPhone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"需要正確的電話號碼"},onSubmit(){if(this.cart.carts.length===0)alert("購物車不得為空");else{const l={data:{user:this.user,message:this.message}};this.$http.post(`${_}/api/${p}/order`,l).then(t=>{alert(t.data.message),this.getCart()}).catch(t=>{let i="";t.data.message.forEach(r=>{i+=r+`
\r`}),alert(i)})}},getCart(){this.isLoading=!0,this.$http.get(`${_}/api/${p}/cart`).then(l=>{this.cart={...l.data.data};for(let t=0;t<this.cart.carts.length;t++)this.cart.carts[t].cancelLoading=!1;this.isLoading=!1}).catch(l=>{console.dir(l),this.isLoading=!1})},renewCart(l,t){this.isEntering=!0,this.$http.put(`${_}/api/${p}/cart/${l.id}`,{data:{product_id:l.product.id,qty:t}}).then(i=>{alert(i.data.message),this.isEntering=!1,this.getCart()}).catch(i=>{alert(i.message),this.isEntering=!1})},clearCart(){if(this.$refs.deleteAllModal.closeModal(),this.cart.carts.length===0){alert("購物車已經是空的");return}this.isDeleteAll=!0,this.$http.delete(`${_}/api/${p}/carts`).then(l=>{this.isDeleteAll=!1,alert("全部商品"+l.data.message),this.cart={carts:[]}}).catch(l=>{this.isDeleteAll=!1,alert(l.message)})},deleteItem(l){l.cancelLoading=!0,this.$http.delete(`${_}/api/${p}/cart/${l.id}`).then(t=>{alert(`${l.product.title}${t.data.message}`),l.cancelLoading=!1,this.getCart()}).catch(t=>{alert(t.message),l.cancelLoading=!1})},sendCouponCode(){this.isDiscount=!0;const l={code:this.couponCode};this.$http.post(`${_}/api/${p}/coupon`,{data:l}).then(t=>{alert(t.data.message),this.getCart(),this.isDiscount=!1}).catch(t=>{alert(t.response.data.message),this.isDiscount=!1})},currency(l){return`${parseInt(l,10).toFixed(0).replace(/./g,(i,r,s)=>r&&i!=="."&&(s.length-r)%3===0?`, ${i}`.replace(/\s/g,""):i)}`},openDeleteAllModal(){this.$refs.deleteAllModal.openModal()}},mounted(){this.getCart()}},G={class:"container"},H=e("div",{class:"text-center h3 my-4"},"購物車頁面",-1),J={class:"text-end"},K=["disabled"],O={class:"table align-middle"},Q=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),W=["onClick"],X={class:"text-success"},Y={class:"input-group input-group-sm"},Z={class:"input-group mb-3"},ee=["disabled","onUpdate:modelValue","onChange"],te={class:"input-group-text",id:"basic-addon2"},se={class:"text-end"},le={class:"text-success"},ae=e("td",{colspan:"3",class:"text-end"},"總計",-1),oe={class:"text-end"},ne=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ie={class:"text-end text-success"},de={class:"row"},ce={class:"col-4 ms-auto"},re={class:"input-group mb-3"},ue=["disabled"],me={class:"my-5 row justify-content-center"},he={class:"mb-3"},_e=e("label",{for:"email",class:"form-label"},"Email",-1),pe={class:"mb-3"},be=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),fe={class:"mb-3"},ge=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),ve={class:"mb-3"},ye=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Ce={class:"mb-3"},xe=e("label",{for:"message",class:"form-label"},"留言",-1),De=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function Me(l,t,i,r,s,d){const M=u("myLoading"),x=u("font-awesome-icon"),f=u("v-field"),g=u("error-message"),A=u("v-form"),k=u("DeleteAllModal");return y(),C(V,null,[o(M,{active:s.isLoading},null,8,["active"]),e("div",G,[H,e("div",J,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:t[0]||(t[0]=a=>d.openDeleteAllModal()),disabled:s.isDeleteAll},[c(o(x,{icon:"spinner",class:"fa-spin"},null,512),[[m,s.isDeleteAll]]),v(" 清空購物車 ")],8,K)]),e("table",O,[Q,e("tbody",null,[s.cart?(y(!0),C(V,{key:0},L(s.cart.carts,a=>(y(),C("tr",{key:a.id},[e("td",null,[e("button",{type:"button",class:h(["btn btn-outline-danger btn-sm",{disabled:a.cancelLoading}]),onClick:n=>d.deleteItem(a)},[c(o(x,{icon:"spinner",class:"fa-spin"},null,512),[[m,a.cancelLoading]]),v(" x ")],10,W)]),e("td",null,[v(b(a.product.title)+" ",1),c(e("div",X,"已套用優惠券",512),[[m,a.final_total!==a.total]])]),e("td",null,[e("div",Y,[e("div",Z,[c(e("input",{min:"1",type:"number",class:"form-control",disabled:s.isEntering,"onUpdate:modelValue":n=>a.qty=n,onChange:n=>d.renewCart(a,a.qty)},null,40,ee),[[D,a.qty]]),e("span",te,b(a.product.unit),1)])])]),e("td",se,[c(e("small",le,"折扣價：",512),[[m,a.final_total!==a.total]]),e("span",{class:h({"text-success":a.final_total!==a.total})},b(d.currency(a.final_total)),3)])]))),128)):E("",!0)]),e("tfoot",null,[e("tr",null,[ae,e("td",oe,b(s.cart.total),1)]),c(e("tr",null,[ne,e("td",ie,b(d.currency(s.cart.final_total)),1)],512),[[m,s.cart.total!==s.cart.final_total]])])]),e("div",de,[e("div",ce,[e("div",re,[c(e("input",{type:"text",class:"form-control",placeholder:"請輸入折扣碼","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":t[1]||(t[1]=a=>s.couponCode=a)},null,512),[[D,s.couponCode]]),e("button",{class:"btn btn-outline-primary",type:"button",disabled:s.isDiscount,id:"button-addon2",onClick:t[2]||(t[2]=a=>d.sendCouponCode())},[c(o(x,{icon:"spinner",class:"fa-spin"},null,512),[[m,s.isDiscount]]),v(" 送出折扣碼")],8,ue)])])]),e("div",me,[o(A,{onSubmit:d.onSubmit,ref:"form",class:"col-md-6"},{default:U(({errors:a})=>[e("div",he,[_e,o(f,{id:"email",name:"email",type:"email",class:h(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.user.email,"onUpdate:modelValue":t[3]||(t[3]=n=>s.user.email=n)},null,8,["class","modelValue"]),o(g,{name:"email",class:"invalid-feedback"})]),e("div",pe,[be,o(f,{id:"name",name:"姓名",type:"text",class:h(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.user.name,"onUpdate:modelValue":t[4]||(t[4]=n=>s.user.name=n)},null,8,["class","modelValue"]),o(g,{name:"姓名",class:"invalid-feedback"})]),e("div",fe,[ge,o(f,{id:"tel",name:"電話",type:"text",class:h(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:d.isPhone,modelValue:s.user.tel,"onUpdate:modelValue":t[5]||(t[5]=n=>s.user.tel=n)},null,8,["class","rules","modelValue"]),o(g,{name:"電話",class:"invalid-feedback"})]),e("div",ve,[ye,o(f,{id:"address",name:"地址",type:"text",class:h(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.user.address,"onUpdate:modelValue":t[6]||(t[6]=n=>s.user.address=n)},null,8,["class","modelValue"]),o(g,{name:"地址",class:"invalid-feedback"})]),e("div",Ce,[xe,c(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[7]||(t[7]=n=>s.message=n)},null,512),[[D,s.message]])]),De]),_:1},8,["onSubmit"])])]),o(k,{onClearAll:d.clearCart,ref:"deleteAllModal"},null,8,["onClearAll"])],64)}const $e=$(R,[["render",Me]]);export{$e as default};
